{
  "$schema": "https://ui.shadcn.com/schema/registry-item.json",
  "name": "file-upload",
  "type": "registry:component",
  "title": "File Upload",
  "description": "Advanced file upload component with drag & drop, progress tracking, validation, and preview support",
  "dependencies": [
    "class-variance-authority",
    "clsx",
    "tailwind-merge"
  ],
  "registryDependencies": [
    "nocta-icons",
    "button",
    "spinner"
  ],
  "files": [
    {
      "path": "registry/ui/file-upload.tsx",
      "content": "'use client';\n\nimport { cva, type VariantProps } from 'class-variance-authority';\nimport React, { useCallback, useState } from 'react';\nimport { cn } from '@/lib/utils';\nimport { Button } from '@/registry/ui/button';\nimport { Icons } from '@/registry/ui/nocta-icons';\nimport { Spinner } from '@/registry/ui/spinner';\n\nconst fileUploadVariants = cva(\n\t[\n\t\t'relative border rounded-lg',\n\t\t'focus-within:ring-1 focus-within:ring-offset-1 focus-within:outline-none',\n\t\t'focus-within:ring-offset-ring-offset/50',\n\t\t'focus-within:ring-ring/50',\n\t\t'transition-[box-shadow] duration-100 ease-out-quad',\n\t],\n\t{\n\t\tvariants: {\n\t\t\tvariant: {\n\t\t\t\tdefault: 'bg-card border-dashed border-border',\n\t\t\t},\n\t\t\tsize: {\n\t\t\t\tsm: 'w-sm p-4',\n\t\t\t\tmd: 'w-md p-6',\n\t\t\t\tlg: 'w-lg p-8',\n\t\t\t},\n\t\t\tstate: {\n\t\t\t\tidle: '',\n\t\t\t\tdragover: ['border-background/60 scale-[1.02]'],\n\t\t\t\terror: ['border-destructive/40'],\n\t\t\t},\n\t\t},\n\t\tdefaultVariants: {\n\t\t\tvariant: 'default',\n\t\t\tsize: 'md',\n\t\t\tstate: 'idle',\n\t\t},\n\t},\n);\n\nconst fileItemVariants = cva(\n\t['flex items-center gap-3 rounded-lg border p-3 bg-card border-border'],\n\t{\n\t\tvariants: {\n\t\t\tstatus: {\n\t\t\t\tpending: '',\n\t\t\t\tuploading: '',\n\t\t\t\tsuccess: '',\n\t\t\t\terror: '',\n\t\t\t},\n\t\t\tsize: {\n\t\t\t\tsm: 'max-w-sm',\n\t\t\t\tmd: 'max-w-md',\n\t\t\t\tlg: 'max-w-lg',\n\t\t\t},\n\t\t},\n\t\tdefaultVariants: {\n\t\t\tstatus: 'pending',\n\t\t\tsize: 'md',\n\t\t},\n\t},\n);\n\nexport interface FileUploadFile {\n\tid: string;\n\tfile: File;\n\tpreview?: string;\n\tprogress?: number;\n\tstatus: 'pending' | 'uploading' | 'success' | 'error';\n\terror?: string;\n}\n\nexport interface FileUploadProps\n\textends Omit<React.ComponentPropsWithoutRef<'div'>, 'onChange'>,\n\t\tVariantProps<typeof fileUploadVariants> {\n\tmultiple?: boolean;\n\taccept?: string;\n\tmaxSize?: number;\n\tmaxFiles?: number;\n\tdisabled?: boolean;\n\tfiles?: FileUploadFile[];\n\tonFilesChange?: (files: FileUploadFile[]) => void;\n\tonUpload?: (files: FileUploadFile[]) => Promise<void>;\n\tshowProgress?: boolean;\n\tshowPreview?: boolean;\n\tuploadText?: string;\n\tdragText?: string;\n\tclassName?: string;\n}\n\nexport interface FileUploadZoneProps\n\textends Omit<React.ComponentPropsWithoutRef<'button'>, 'onChange'> {\n\tonFilesSelect: (files: File[]) => void;\n\taccept?: string;\n\tmultiple?: boolean;\n\tdisabled?: boolean;\n\tchildren: React.ReactNode;\n}\n\nexport interface FileUploadItemProps {\n\tfile: FileUploadFile;\n\tshowPreview?: boolean;\n\tonRemove?: (id: string) => void;\n\tsize?: 'sm' | 'md' | 'lg';\n\tclassName?: string;\n}\n\nexport interface FileUploadProgressProps {\n\tprogress: number;\n\tclassName?: string;\n}\n\nconst formatFileSize = (bytes: number): string => {\n\tif (bytes === 0) return '0 Bytes';\n\tconst k = 1024;\n\tconst sizes = ['Bytes', 'KB', 'MB', 'GB'];\n\tconst i = Math.floor(Math.log(bytes) / Math.log(k));\n\treturn `${parseFloat((bytes / k ** i).toFixed(2))} ${sizes[i]}`;\n};\n\nconst createFilePreview = (file: File): Promise<string | null> => {\n\treturn new Promise((resolve) => {\n\t\tif (!file.type.startsWith('image/')) {\n\t\t\tresolve(null);\n\t\t\treturn;\n\t\t}\n\n\t\tconst reader = new FileReader();\n\t\treader.onload = (e) => resolve(e.target?.result as string);\n\t\treader.onerror = () => resolve(null);\n\t\treader.readAsDataURL(file);\n\t});\n};\n\nexport const FileUploadZone: React.FC<FileUploadZoneProps> = ({\n\tonFilesSelect,\n\taccept,\n\tmultiple = false,\n\tdisabled = false,\n\tchildren,\n\tclassName,\n\t...props\n}) => {\n\tconst inputRef = React.useRef<HTMLInputElement>(null);\n\n\tconst handleFileInput = (e: React.ChangeEvent<HTMLInputElement>) => {\n\t\tconst files = Array.from(e.target.files || []);\n\t\tif (files.length > 0) {\n\t\t\tonFilesSelect(files);\n\t\t}\n\t\tif (inputRef.current) {\n\t\t\tinputRef.current.value = '';\n\t\t}\n\t};\n\n\tconst handleClick = () => {\n\t\tif (!disabled) {\n\t\t\tinputRef.current?.click();\n\t\t}\n\t};\n\n\treturn (\n\t\t<button\n\t\t\ttype=\"button\"\n\t\t\tdisabled={disabled}\n\t\t\tclassName={cn(\n\t\t\t\t'w-full cursor-pointer focus-visible:ring-0 focus-visible:outline-none',\n\t\t\t\tdisabled && 'cursor-not-allowed opacity-50',\n\t\t\t\tclassName,\n\t\t\t)}\n\t\t\tonClick={handleClick}\n\t\t\taria-label={multiple ? 'Select files to upload' : 'Select file to upload'}\n\t\t\t{...props}\n\t\t>\n\t\t\t<input\n\t\t\t\tref={inputRef}\n\t\t\t\ttype=\"file\"\n\t\t\t\taccept={accept}\n\t\t\t\tmultiple={multiple}\n\t\t\t\tdisabled={disabled}\n\t\t\t\tonChange={handleFileInput}\n\t\t\t\tclassName=\"sr-only\"\n\t\t\t/>\n\t\t\t{children}\n\t\t</button>\n\t);\n};\n\nexport const FileUploadProgress: React.FC<FileUploadProgressProps> = ({\n\tprogress,\n\tclassName,\n}) => {\n\treturn (\n\t\t<div className={cn('h-2 w-full rounded-full bg-card-muted', className)}>\n\t\t\t<div\n\t\t\t\tclassName=\"h-2 rounded-full bg-foreground transition-[width] duration-100 ease-out-quad\"\n\t\t\t\tstyle={{ width: `${Math.min(100, Math.max(0, progress))}%` }}\n\t\t\t\trole=\"progressbar\"\n\t\t\t\taria-valuenow={progress}\n\t\t\t\taria-valuemin={0}\n\t\t\t\taria-valuemax={100}\n\t\t\t/>\n\t\t</div>\n\t);\n};\n\nexport const FileUploadItem: React.FC<FileUploadItemProps> = ({\n\tfile,\n\tshowPreview = true,\n\tonRemove,\n\tsize = 'md',\n\tclassName,\n}) => {\n\tconst handleRemove = () => {\n\t\tonRemove?.(file.id);\n\t};\n\n\tconst isUploading =\n\t\tfile.status === 'uploading' && typeof file.progress === 'number';\n\n\treturn (\n\t\t<li\n\t\t\tclassName={cn(fileItemVariants({ status: file.status, size }), className)}\n\t\t>\n\t\t\t<div className=\"shrink-0\">\n\t\t\t\t{showPreview && file.preview ? (\n\t\t\t\t\t/* biome-ignore lint/performance/noImgElement: prefer native img here */\n\t\t\t\t\t<img\n\t\t\t\t\t\tsrc={file.preview}\n\t\t\t\t\t\talt={file.file.name}\n\t\t\t\t\t\tclassName=\"h-10 w-10 rounded object-cover\"\n\t\t\t\t\t/>\n\t\t\t\t) : (\n\t\t\t\t\t<div className=\"flex h-10 w-10 items-center justify-center\">\n\t\t\t\t\t\t<Icons.FileUpload aria-hidden=\"true\" className=\"h-6 w-6\" />\n\t\t\t\t\t</div>\n\t\t\t\t)}\n\t\t\t</div>\n\n\t\t\t<div className=\"min-w-0 flex-1\">\n\t\t\t\t<div className=\"flex items-center justify-between gap-2\">\n\t\t\t\t\t<p className=\"min-w-0 flex-1 truncate text-sm font-medium text-foreground\">\n\t\t\t\t\t\t{file.file.name}\n\t\t\t\t\t</p>\n\t\t\t\t\t{onRemove && (\n\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\tclassName=\"size-6 rounded-sm cursor-pointer text-foreground/45 hover:text-foreground/70 focus-visible:ring-1 focus-visible:ring-ring/50 focus-visible:ring-offset-1 focus-visible:ring-offset-ring-offset/50 focus-visible:outline-none\"\n\t\t\t\t\t\t\tvariant=\"icon\"\n\t\t\t\t\t\t\tonClick={handleRemove}\n\t\t\t\t\t\t\taria-label={`Remove ${file.file.name}`}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<Icons.X aria-hidden=\"true\" className=\"h-4 w-4\" />\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t)}\n\t\t\t\t</div>\n\n\t\t\t\t<div className=\"mt-1 flex min-w-0 items-center gap-2\">\n\t\t\t\t\t<p className=\"shrink-0 text-xs text-foreground/70\">\n\t\t\t\t\t\t{formatFileSize(file.file.size)}\n\t\t\t\t\t</p>\n\n\t\t\t\t\t{file.status === 'error' && file.error && (\n\t\t\t\t\t\t<p className=\"truncate text-xs text-destructive/90 font-medium\">\n\t\t\t\t\t\t\t{file.error}\n\t\t\t\t\t\t</p>\n\t\t\t\t\t)}\n\n\t\t\t\t\t{file.status === 'success' && (\n\t\t\t\t\t\t<span className=\"flex shrink-0 items-center gap-1 text-xs font-medium text-success/90\">\n\t\t\t\t\t\t\t<Icons.Check aria-hidden=\"true\" className=\"h-4 w-4\" />\n\t\t\t\t\t\t\tUploaded\n\t\t\t\t\t\t</span>\n\t\t\t\t\t)}\n\t\t\t\t</div>\n\n\t\t\t\t<div className=\"mt-2 h-2\">\n\t\t\t\t\t<div\n\t\t\t\t\t\tclassName={cn(\n\t\t\t\t\t\t\t'transition-opacity duration-100',\n\t\t\t\t\t\t\tisUploading ? 'opacity-100' : 'opacity-0',\n\t\t\t\t\t\t)}\n\t\t\t\t\t>\n\t\t\t\t\t\t<FileUploadProgress progress={file.progress || 0} />\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</li>\n\t);\n};\n\nexport const FileUpload: React.FC<FileUploadProps> = ({\n\tvariant = 'default',\n\tsize = 'md',\n\tmultiple = false,\n\taccept,\n\tmaxSize,\n\tmaxFiles,\n\tdisabled = false,\n\tfiles = [],\n\tonFilesChange,\n\tonUpload,\n\tshowPreview = true,\n\tuploadText = 'Click to upload or drag and drop',\n\tdragText = 'Drop files here',\n\tclassName,\n\t...props\n}) => {\n\tconst [isDragOver, setIsDragOver] = useState(false);\n\tconst [dragState, setDragState] = useState<'idle' | 'dragover' | 'error'>(\n\t\t'idle',\n\t);\n\n\tconst validateFile = useCallback(\n\t\t(file: File): string | null => {\n\t\t\tif (maxSize && file.size > maxSize) {\n\t\t\t\treturn `File size exceeds ${formatFileSize(maxSize)}`;\n\t\t\t}\n\n\t\t\tif (accept) {\n\t\t\t\tconst acceptedTypes = accept.split(',').map((type) => type.trim());\n\t\t\t\tconst isValidType = acceptedTypes.some((type) => {\n\t\t\t\t\tif (type.startsWith('.')) {\n\t\t\t\t\t\treturn file.name.toLowerCase().endsWith(type.toLowerCase());\n\t\t\t\t\t}\n\t\t\t\t\treturn file.type.match(type.replace('*', '.*'));\n\t\t\t\t});\n\n\t\t\t\tif (!isValidType) {\n\t\t\t\t\treturn `File type not accepted. Accepted types: ${accept}`;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn null;\n\t\t},\n\t\t[maxSize, accept],\n\t);\n\n\tconst handleFilesSelect = useCallback(\n\t\tasync (newFiles: File[]) => {\n\t\t\tconst validFiles: FileUploadFile[] = [];\n\n\t\t\tfor (const file of newFiles) {\n\t\t\t\tif (maxFiles && files.length + validFiles.length >= maxFiles) {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tconst error = validateFile(file);\n\t\t\t\tconst preview = showPreview ? await createFilePreview(file) : null;\n\n\t\t\t\tconst fileUpload: FileUploadFile = {\n\t\t\t\t\tid: `${Date.now()}-${Math.random().toString(36).substr(2, 9)}`,\n\t\t\t\t\tfile,\n\t\t\t\t\tstatus: error ? 'error' : 'pending',\n\t\t\t\t\t...(preview !== null ? { preview } : {}),\n\t\t\t\t\t...(error ? { error } : {}),\n\t\t\t\t};\n\n\t\t\t\tvalidFiles.push(fileUpload);\n\t\t\t}\n\n\t\t\tconst updatedFiles = multiple ? [...files, ...validFiles] : validFiles;\n\t\t\tonFilesChange?.(updatedFiles);\n\n\t\t\tsetDragState('idle');\n\t\t\tsetIsDragOver(false);\n\t\t},\n\t\t[files, maxFiles, validateFile, multiple, showPreview, onFilesChange],\n\t);\n\n\tconst handleRemoveFile = useCallback(\n\t\t(id: string) => {\n\t\t\tconst updatedFiles = files.filter((file) => file.id !== id);\n\t\t\tonFilesChange?.(updatedFiles);\n\t\t},\n\t\t[files, onFilesChange],\n\t);\n\n\tconst handleUpload = useCallback(async () => {\n\t\tif (!onUpload) return;\n\n\t\tconst pendingFiles = files.filter((file) => file.status === 'pending');\n\t\tif (pendingFiles.length === 0) return;\n\n\t\tconst updatedFiles = files.map((file) =>\n\t\t\tfile.status === 'pending'\n\t\t\t\t? { ...file, status: 'uploading' as const, progress: 0 }\n\t\t\t\t: file,\n\t\t);\n\t\tonFilesChange?.(updatedFiles);\n\n\t\ttry {\n\t\t\tawait onUpload(pendingFiles);\n\n\t\t\tconst successFiles = updatedFiles.map((file) =>\n\t\t\t\tfile.status === 'uploading'\n\t\t\t\t\t? { ...file, status: 'success' as const, progress: 100 }\n\t\t\t\t\t: file,\n\t\t\t);\n\t\t\tonFilesChange?.(successFiles);\n\t\t} catch {\n\t\t\tconst errorFiles = updatedFiles.map((file) =>\n\t\t\t\tfile.status === 'uploading'\n\t\t\t\t\t? { ...file, status: 'error' as const, error: 'Upload failed' }\n\t\t\t\t\t: file,\n\t\t\t);\n\t\t\tonFilesChange?.(errorFiles);\n\t\t}\n\t}, [files, onUpload, onFilesChange]);\n\n\tconst handleDragEnter = (e: React.DragEvent) => {\n\t\te.preventDefault();\n\t\te.stopPropagation();\n\t\tif (!disabled) {\n\t\t\tsetIsDragOver(true);\n\t\t\tsetDragState('dragover');\n\t\t}\n\t};\n\n\tconst handleDragLeave = (e: React.DragEvent) => {\n\t\te.preventDefault();\n\t\te.stopPropagation();\n\t\tif (!e.currentTarget.contains(e.relatedTarget as Node)) {\n\t\t\tsetIsDragOver(false);\n\t\t\tsetDragState('idle');\n\t\t}\n\t};\n\n\tconst handleDragOver = (e: React.DragEvent) => {\n\t\te.preventDefault();\n\t\te.stopPropagation();\n\t};\n\n\tconst handleDrop = (e: React.DragEvent) => {\n\t\te.preventDefault();\n\t\te.stopPropagation();\n\n\t\tif (disabled) return;\n\n\t\tconst droppedFiles = Array.from(e.dataTransfer.files);\n\t\thandleFilesSelect(droppedFiles);\n\t};\n\n\tconst state = disabled ? 'idle' : dragState;\n\tconst hasFiles = files.length > 0;\n\tconst pendingFiles = files.filter((file) => file.status === 'pending');\n\tconst uploadingFiles = files.filter((file) => file.status === 'uploading');\n\tconst isUploading = uploadingFiles.length > 0;\n\n\treturn (\n\t\t<div className={cn('space-y-4', className)} {...props}>\n\t\t\t<section\n\t\t\t\taria-label=\"File upload dropzone\"\n\t\t\t\tclassName={cn(fileUploadVariants({ variant, size, state }))}\n\t\t\t\tonDragEnter={handleDragEnter}\n\t\t\t\tonDragLeave={handleDragLeave}\n\t\t\t\tonDragOver={handleDragOver}\n\t\t\t\tonDrop={handleDrop}\n\t\t\t>\n\t\t\t\t<FileUploadZone\n\t\t\t\t\tonFilesSelect={handleFilesSelect}\n\t\t\t\t\tmultiple={multiple}\n\t\t\t\t\tdisabled={disabled}\n\t\t\t\t\t{...(accept !== undefined ? { accept } : {})}\n\t\t\t\t>\n\t\t\t\t\t<div className=\"flex flex-col items-center justify-center text-center\">\n\t\t\t\t\t\t<div className=\"mb-3\">\n\t\t\t\t\t\t\t<Icons.FileUpload\n\t\t\t\t\t\t\t\taria-hidden=\"true\"\n\t\t\t\t\t\t\t\tclassName={cn(\n\t\t\t\t\t\t\t\t\t'mx-auto transition-[color]',\n\t\t\t\t\t\t\t\t\tsize === 'sm'\n\t\t\t\t\t\t\t\t\t\t? 'size-5'\n\t\t\t\t\t\t\t\t\t\t: size === 'lg'\n\t\t\t\t\t\t\t\t\t\t\t? 'size-7'\n\t\t\t\t\t\t\t\t\t\t\t: 'size-6',\n\t\t\t\t\t\t\t\t\tisDragOver ? 'text-foreground/45' : 'text-foreground/45',\n\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<div className=\"text-sm\">\n\t\t\t\t\t\t\t<p\n\t\t\t\t\t\t\t\tclassName={cn(\n\t\t\t\t\t\t\t\t\t'font-medium',\n\t\t\t\t\t\t\t\t\tisDragOver ? 'text-foreground/45' : 'text-foreground/70',\n\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t{isDragOver ? dragText : uploadText}\n\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t{!isDragOver && (\n\t\t\t\t\t\t\t\t<div className=\"mt-1 space-y-1\">\n\t\t\t\t\t\t\t\t\t{accept && (\n\t\t\t\t\t\t\t\t\t\t<p className=\"text-xs text-foreground/45\">\n\t\t\t\t\t\t\t\t\t\t\tAccepted types: {accept}\n\t\t\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t{maxSize && (\n\t\t\t\t\t\t\t\t\t\t<p className=\"text-xs text-foreground/45\">\n\t\t\t\t\t\t\t\t\t\t\tMax size: {formatFileSize(maxSize)}\n\t\t\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t{multiple && maxFiles && (\n\t\t\t\t\t\t\t\t\t\t<p className=\"text-xs text-foreground/45\">\n\t\t\t\t\t\t\t\t\t\t\tMax files: {maxFiles}\n\t\t\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</FileUploadZone>\n\t\t\t</section>\n\n\t\t\t{hasFiles && (\n\t\t\t\t<div className=\"space-y-2\">\n\t\t\t\t\t<div className=\"flex items-center justify-between\">\n\t\t\t\t\t\t<h4 className=\"text-sm font-medium text-foreground\">\n\t\t\t\t\t\t\tFiles ({files.length}\n\t\t\t\t\t\t\t{maxFiles ? `/${maxFiles}` : ''})\n\t\t\t\t\t\t</h4>\n\t\t\t\t\t\t{(pendingFiles.length > 0 || isUploading) && onUpload && (\n\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\tonClick={handleUpload}\n\t\t\t\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\t\t\t\tvariant=\"ghost\"\n\t\t\t\t\t\t\t\tclassName=\"bg-foreground text-card hover:bg-foreground/80\"\n\t\t\t\t\t\t\t\tdisabled={disabled || isUploading}\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t{isUploading && <Spinner size=\"sm\" variant=\"default\" />}\n\t\t\t\t\t\t\t\t{isUploading\n\t\t\t\t\t\t\t\t\t? `Uploading ${uploadingFiles.length} file${uploadingFiles.length > 1 ? 's' : ''}...`\n\t\t\t\t\t\t\t\t\t: `Upload ${pendingFiles.length} file${pendingFiles.length > 1 ? 's' : ''}`}\n\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t)}\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<ul className=\"max-h-60 space-y-2 overflow-y-auto\">\n\t\t\t\t\t\t{files.map((file) => (\n\t\t\t\t\t\t\t<FileUploadItem\n\t\t\t\t\t\t\t\tkey={file.id}\n\t\t\t\t\t\t\t\tfile={file}\n\t\t\t\t\t\t\t\tshowPreview={showPreview}\n\t\t\t\t\t\t\t\tonRemove={handleRemoveFile}\n\t\t\t\t\t\t\t\tsize={size || 'md'}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t))}\n\t\t\t\t\t</ul>\n\t\t\t\t</div>\n\t\t\t)}\n\t\t</div>\n\t);\n};\n",
      "type": "registry:component"
    }
  ]
}